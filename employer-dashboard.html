<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Employer Dashboard â€” Confetti Love Manila</title>
    <style>
       * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Segoe UI", Tahoma, sans-serif;
      background: linear-gradient(135deg,
             rgba(173, 216, 230, 0.7),
             /* light blue */
             rgba(255, 182, 193, 0.7),
             /* pink */
             rgba(144, 238, 144, 0.7),
             /* light green */
             rgba(255, 255, 153, 0.7),
             /* yellow */
             rgba(221, 160, 221, 0.7)
             /* purple (added extra color) */
         );
      color: #333;
      min-height: 100vh;
    }

    .container {
      max-width: 1000px;
      margin: 20px auto;
      padding: 16px;
    }

    .topbar {
      background: #fff;
      padding: 12px 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-radius: 12px;
      margin: 12px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .brand-logo-small {
      width: 80px;
      border-radius: 50%;
    }

    .user-area {
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 500;
      flex-wrap: wrap;
    }

    .btn {
      padding: 6px 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: background 0.2s;
      font-size: 14px;
    }

    .btn.ghost {
      background: transparent;
      border: 1px solid #aaa;
      color: #555;
    }

    .btn.ghost:hover {
      background: #f4f4f4;
    }

    .btn.danger {
      background: #ff6b6b;
      color: #fff;
    }

    .btn.danger:hover {
      background: #e85656;
    }

    .card {
      background: #fff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
      margin-top: 20px;
      overflow-x: auto; /* makes table scrollable */
    }

    .card h3 {
      margin-bottom: 16px;
      color: #444;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    table.att-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      min-width: 600px; /* prevents collapsing */
    }

    table.att-table th,
    table.att-table td {
      padding: 10px 12px;
      text-align: left;
      border-bottom: 1px solid #eee;
      vertical-align: top;
    }

    table.att-table th {
      background: #f3f6fb;
      font-weight: 600;
      font-size: 13px;
      color: #444;
    }

    table.att-table tr:hover {
      background: #fafafa;
    }

    td.editable {
      cursor: pointer;
      color: #444;
    }

    td.editable:hover {
      background: #f9f2ff;
    }

    td.editable input {
      border: 1px solid #ddd;
      padding: 6px;
      border-radius: 6px;
      width: 100%;
    }

    .muted {
      text-align: center;
      color: #888;
      font-style: italic;
      padding: 12px;
    }

    .action-cell {
      text-align: center;
    }

    /* âœ… Responsive styles */
    @media (max-width: 768px) {
      body {
        font-size: 14px;
      }

      .topbar {
        flex-direction: column;
        align-items: flex-start;
      }

      .brand-logo-small {
        width: 60px;
      }

      .btn {
        font-size: 12px;
        padding: 5px 10px;
      }

      table.att-table {
        font-size: 12px;
      }
    }

    @media (max-width: 480px) {
      .card h3 {
        flex-direction: column;
        align-items: flex-start;
      }

      table.att-table th,
      table.att-table td {
        padding: 6px;
      }
    }
    </style>
</head>

<body>
    <header class="topbar">
        <img src="bg.jpg" alt="Confetti Love Manila" class="brand-logo-small" />
        <div class="user-area">
            <div id="welcome">Welcome</div>
            <button id="logoutBtn" class="btn ghost">Logout</button>
        </div>
    </header>

    <main class="container">
        <section class="card">
            <h3>
                All Employee Attendance
                <button id="deleteAllBtn" class="btn danger">Delete All</button>
            </h3>
            <table id="attTable" class="att-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Name</th>
                        <th>Date</th>
                        <th>Job Description</th>
                        <th>Time In</th>
                        <th>Time Out</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <p id="noRecords" class="muted">No attendance recorded yet.</p>
        </section>
    </main>

    <script>
        function loadUser() {
            const raw = localStorage.getItem('attendance_user');
            if (!raw) { location.href = 'index.html'; return null; }
            return JSON.parse(raw);
        }

        function loadRecords() {
            let all = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('records_')) {
                    const recs = JSON.parse(localStorage.getItem(key)) || [];
                    const name = key.replace('records_', '').replace(/_/g, ' ');
                    recs.forEach(r => all.push({ ...r, fullname: name }));
                }
            }
            return all;
        }

        function renderTable(records) {
            const tbody = document.querySelector('#attTable tbody');
            tbody.innerHTML = '';
            if (!records.length) {
                document.getElementById('noRecords').style.display = 'block';
                document.getElementById('attTable').style.display = 'none';
                return;
            }
            document.getElementById('noRecords').style.display = 'none';
            document.getElementById('attTable').style.display = 'table';

            let count = 1;
            const grouped = {};

            records.forEach(r => {
                if (!grouped[r.fullname]) grouped[r.fullname] = {};
                if (!grouped[r.fullname][r.date]) grouped[r.fullname][r.date] = [];
                grouped[r.fullname][r.date].push(r);
            });

            for (const name in grouped) {
                const dates = grouped[name];
                for (const date in dates) {
                    const dayRecords = dates[date];
                    const descs = dayRecords.map(r => r.description || '-').join('<br>');
                    const timesIn = dayRecords.map(r => r.timeIn || '-').join('<br>');
                    const timesOut = dayRecords.map(r => r.timeOut || '-').join('<br>');

                    const tr = document.createElement('tr');
                    tr.innerHTML = `
            <td>${count++}</td>
            <td>${name}</td>
            <td>${date}</td>
            <td class="editable">${descs}</td>
            <td>${timesIn}</td>
            <td>${timesOut}</td>
            <td class="action-cell">
              <button class="btn danger btn-sm">ðŸ—‘</button>
            </td>
          `;
                    tbody.appendChild(tr);

                    // Edit description
                    const descCell = tr.querySelector('.editable');
                    descCell.addEventListener('click', () => {
                        const current = descCell.textContent;
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.value = current;
                        descCell.textContent = '';
                        descCell.appendChild(input);
                        input.focus();
                        input.addEventListener('keydown', e => {
                            if (e.key === 'Enter') saveDesc(dayRecords, input.value);
                        });
                        input.addEventListener('blur', () => saveDesc(dayRecords, input.value));
                    });

                    // Delete group
                    const deleteBtn = tr.querySelector('.btn-sm');
                    deleteBtn.addEventListener('click', () => {
                        if (confirm(`Delete all records for ${name} on ${date}?`)) {
                            deleteGroup(dayRecords);
                        }
                    });
                }
            }
        }

        function saveDesc(recordsArr, value) {
            value = value.trim() || '-';
            recordsArr.forEach(r => {
                r.description = value;
                const key = 'records_' + r.fullname.replace(/\s+/g, '_').toLowerCase();
                let recs = JSON.parse(localStorage.getItem(key)) || [];
                const idx = recs.findIndex(x => x.date === r.date && x.timeIn === r.timeIn);
                if (idx !== -1) recs[idx].description = value;
                localStorage.setItem(key, JSON.stringify(recs));
            });
            renderTable(loadRecords());
        }

        function deleteGroup(recordsArr) {
            const key = 'records_' + recordsArr[0].fullname.replace(/\s+/g, '_').toLowerCase();
            let recs = JSON.parse(localStorage.getItem(key)) || [];
            recs = recs.filter(r => !(r.date === recordsArr[0].date));
            localStorage.setItem(key, JSON.stringify(recs));
            renderTable(loadRecords());
        }

        const user = loadUser();
        if (user.role !== 'employer') location.href = 'employee-dashboard.html';
        document.getElementById('welcome').textContent = `${user.fullname} (Employer)`;

        renderTable(loadRecords());

        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem('attendance_user');
            location.href = 'index.html';
        });

        document.getElementById('deleteAllBtn').addEventListener('click', () => {
            if (confirm("Delete ALL attendance records?")) {
                Object.keys(localStorage).forEach(key => {
                    if (key.startsWith('records_')) localStorage.removeItem(key);
                });
                renderTable(loadRecords());
            }
        });
    </script>
</body>

</html>